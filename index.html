<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FitnessOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #020617; font-family: 'Inter', sans-serif; color: #e2e8f0; margin: 0; }
        .glass-card { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); margin-bottom: 1rem; }
        /* Ultra-Visible Bold Titles */
        .panel-title { font-size: 18px; font-weight: 900; letter-spacing: 0.12em; text-transform: uppercase; color: #94a3b8; margin-bottom: 1.2rem; display: block; }
        .active-tap:active { transform: scale(0.96); opacity: 0.8; }
        input { background: transparent; border: none; outline: none; color: white; font-weight: 900; }
        .custom-scrollbar::-webkit-scrollbar { height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="fixed inset-0 z-[100] bg-[#020617] flex flex-col items-center justify-center p-6">
        <img src="https://cdn-icons-png.flaticon.com/512/84/84145.png" class="w-16 h-16 invert mb-8 opacity-20">
        <h2 class="text-blue-500 font-black text-2xl mb-6 tracking-tighter">FITNESS OS</h2>
        <input type="password" id="pin-input" inputmode="numeric" placeholder="PIN" class="bg-slate-900 p-5 rounded-2xl w-36 text-center text-2xl tracking-[0.3em] border border-slate-800">
        <button onclick="checkPin()" class="mt-8 bg-blue-600 px-12 py-4 rounded-2xl font-black active-tap shadow-lg shadow-blue-900/40 uppercase tracking-widest text-xs">Unlock System</button>
    </div>

    <div id="main-app" class="hidden p-4 pt-12 pb-32 transition-opacity duration-500">
        
        <div class="glass-card p-6 rounded-[2.5rem] border-b-4 border-blue-500">
            <span class="panel-title text-blue-400">Total Protein</span>
            <div class="flex items-baseline gap-2">
                <span id="total-p" class="text-6xl font-black">0</span>
                <span class="text-slate-500 font-black text-2xl">/ 180g</span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="glass-card p-6 rounded-[2.5rem] border-l-4 border-orange-500">
                <span class="panel-title text-orange-500 text-sm">Carbs</span>
                <span id="total-c" class="text-4xl font-black text-orange-400">0</span><span class="text-xs font-bold text-slate-600 ml-1">g</span>
            </div>
            <div class="glass-card p-6 rounded-[2.5rem] border-l-4 border-yellow-500">
                <span class="panel-title text-yellow-500 text-sm">Fats</span>
                <span id="total-f" class="text-4xl font-black text-yellow-400">0</span><span class="text-xs font-bold text-slate-600 ml-1">g</span>
            </div>
        </div>

        <div class="glass-card p-6 rounded-[2.5rem]">
            <div class="flex justify-between items-center">
                <span class="panel-title">Nutrition Log</span>
                <button onclick="openModal()" class="bg-emerald-500 text-black w-10 h-10 rounded-full font-black text-2xl shadow-lg active-tap">+</button>
            </div>
            <div id="food-log" class="mt-4 space-y-3">
                </div>
        </div>

        <div class="glass-card p-6 rounded-[2.5rem] border-l-4 border-cyan-500">
            <span class="panel-title text-cyan-500">Daily Hydration</span>
            <div class="flex justify-between items-center">
                <button onclick="addWater(-250)" class="bg-slate-800 w-14 h-14 rounded-2xl font-black text-xl border border-slate-700 active-tap">-</button>
                <div class="text-center">
                    <input type="number" id="water-total" value="0" oninput="save()" class="text-4xl w-28 text-center font-black">
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">Milliliters</p>
                </div>
                <button onclick="addWater(250)" class="bg-cyan-600 w-14 h-14 rounded-2xl font-black text-xl shadow-lg shadow-cyan-900/40 active-tap">+</button>
            </div>
        </div>

        <button onclick="archive()" class="fixed bottom-6 left-4 right-4 bg-white text-black font-black py-6 rounded-[2rem] uppercase tracking-[0.2em] text-lg active-tap shadow-2xl z-40 italic">Sync Day to Cloud</button>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/98 z-[110] hidden p-6 flex flex-col justify-center transition-all">
        <div class="glass-card p-8 rounded-[3rem] border border-emerald-500/30">
            <span class="panel-title text-emerald-400">Log New Meal</span>
            
            <p class="text-[10px] text-slate-500 uppercase font-black mb-3 tracking-widest">Recent Choices</p>
            <div id="recent-list" class="flex gap-2 overflow-x-auto mb-6 pb-2 custom-scrollbar">
                </div>

            <input id="m-name" type="text" placeholder="Meal Name" class="w-full bg-slate-900/50 p-5 rounded-2xl mb-4 text-xl border border-slate-800">
            
            <div class="grid grid-cols-3 gap-3 mb-8">
                <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[8px] text-blue-400 font-black uppercase text-center mb-1">P</p>
                    <input id="m-p" type="number" placeholder="0" class="w-full text-center text-2xl font-black">
                </div>
                <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[8px] text-orange-400 font-black uppercase text-center mb-1">C</p>
                    <input id="m-c" type="number" placeholder="0" class="w-full text-center text-2xl font-black">
                </div>
                <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[8px] text-yellow-400 font-black uppercase text-center mb-1">F</p>
                    <input id="m-f" type="number" placeholder="0" class="w-full text-center text-2xl font-black">
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 bg-slate-800 py-5 rounded-2xl font-black uppercase text-xs tracking-widest text-slate-400">Cancel</button>
                <button onclick="logMeal()" class="flex-1 bg-emerald-500 text-black py-5 rounded-2xl font-black uppercase text-xs tracking-widest">Add Entry</button>
            </div>
        </div>
    </div>

    <script>
        const PIN = "0805";
        const GS_URL = "https://script.google.com/macros/s/AKfycbzyIYOLFQsOcJTZ0LCuEz6adaLcr6IOeav3SgBDGFEfpaf74yumU0oKsvLJlmP7nzeWfQ/exec";
        let meals = [];

        function checkPin() {
            if(document.getElementById('pin-input').value === PIN) {
                document.getElementById('auth-screen').classList.add('hidden');
                const app = document.getElementById('main-app');
                app.classList.remove('hidden');
                setTimeout(() => app.style.opacity = '1', 50);
                load();
            } else { 
                alert("ACCESS DENIED"); 
                document.getElementById('pin-input').value = "";
            }
        }

        async function fetchRecent() {
            try {
                const res = await fetch(GS_URL);
                const data = await res.json();
                document.getElementById('recent-list').innerHTML = data.map(m => `
                    <button onclick='fill("${m.name}",${m.p},${m.c},${m.f})' class="bg-slate-800 px-5 py-3 rounded-2xl whitespace-nowrap text-[10px] font-black uppercase border border-slate-700 text-slate-300 active-tap">${m.name}</button>
                `).join('');
            } catch(e) { 
                document.getElementById('recent-list').innerHTML = "<span class='text-[8px] text-slate-600 uppercase'>History Offline</span>";
            }
        }

        window.fill = (n,p,c,f) => {
            document.getElementById('m-name').value = n;
            document.getElementById('m-p').value = p;
            document.getElementById('m-c').value = c;
            document.getElementById('m-f').value = f;
        }

        function addWater(v) {
            const el = document.getElementById('water-total');
            el.value = Math.max(0, parseInt(el.value) + v);
            save();
        }

        async function logMeal() {
            const m = {
                id: Date.now(),
                name: document.getElementById('m-name').value || "Meal",
                p: parseFloat(document.getElementById('m-p').value) || 0,
                c: parseFloat(document.getElementById('m-c').value) || 0,
                f: parseFloat(document.getElementById('m-f').value) || 0,
                type: "meal"
            };
            meals.push(m);
            closeModal();
            save();
            await fetch(GS_URL, {method: 'POST', mode: 'no-cors', body: JSON.stringify(m)});
        }

        async function del(id) {
            meals = meals.filter(m => m.id !== id);
            save();
            await fetch(GS_URL, {method: 'POST', mode: 'no-cors', body: JSON.stringify({action:"delete", id:id})});
        }

        function save() {
            const t = meals.reduce((a, b) => ({p: a.p + b.p, c: a.c + b.c, f: a.f + b.f}), {p:0, c:0, f:0});
            document.getElementById('total-p').innerText = t.p.toFixed(0);
            document.getElementById('total-c').innerText = t.c.toFixed(0);
            document.getElementById('total-f').innerText = t.f.toFixed(0);
            
            document.getElementById('food-log').innerHTML = meals.map(m => `
                <div class="flex justify-between items-center bg-slate-900/60 p-5 rounded-[1.5rem] border border-slate-800">
                    <span class="font-black uppercase text-xs tracking-wider text-slate-200">${m.name}</span>
                    <button onclick="del(${m.id})" class="text-slate-600 font-black text-[9px] border border-slate-800 px-3 py-1 rounded-lg hover:text-red-500">REMOVE</button>
                </div>
            `).join('');
            
            localStorage.setItem('fit_os_simple_v2', JSON.stringify({
                meals, 
                water: document.getElementById('water-total').value, 
                date: new Date().toLocaleDateString()
            }));
        }

        async function archive() {
            const t = meals.reduce((a, b) => ({p: a.p + b.p, c: a.c + b.c, f: a.f + b.f}), {p:0, c:0, f:0});
            const payload = {
                p: t.p.toFixed(1), c: t.c.toFixed(1), f: t.f.toFixed(1), 
                cal: Math.round(t.p*4 + t.c*4 + t.f*9),
                water: document.getElementById('water-total').value,
                id: "ARCHIVE"
            };
            await fetch(GS_URL, {method: 'POST', mode: 'no-cors', body: JSON.stringify(payload)});
            alert("DAY ARCHIVED TO CLOUD");
        }

        function load() {
            const s = JSON.parse(localStorage.getItem('fit_os_simple_v2'));
            if(s && s.date === new Date().toLocaleDateString()) {
                meals = s.meals || [];
                document.getElementById('water-total').value = s.water || 0;
                save();
            }
        }
        
        function openModal() { 
            document.getElementById('m-name').value = "";
            document.getElementById('m-p').value = "";
            document.getElementById('m-c').value = "";
            document.getElementById('m-f').value = "";
            document.getElementById('modal').classList.remove('hidden'); 
            fetchRecent(); 
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
    </script>
</body>
</html>
